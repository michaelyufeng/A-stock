# =============================================================================
# A股量化交易系统 - 监控服务配置文件
# =============================================================================
# 说明: 本文件配置实时监控、信号检测、提醒等功能
# 用途: 盘中监控、持仓跟踪、信号捕捉
# 详细文档: docs/CONFIGURATION_GUIDE.md
# =============================================================================

# -----------------------------------------------------------------------------
# 监控服务基础配置
# -----------------------------------------------------------------------------
monitoring:
  # 行情更新频率 (秒)
  update_interval: 60                  # 每60秒更新一次 (范围: 30-120)
                                       # 建议: 日内交易30-60秒, 中长线60-120秒
                                       # 注意: 间隔越短，API调用越频繁

  # -----------------------------------------------------------------------------
  # 监控列表 - 需要实时跟踪的股票
  # -----------------------------------------------------------------------------
  # 说明: 列出需要监控的股票代码和名称
  # 建议: 不超过30只股票，过多影响性能
  # 用途: 发现买卖点、跟踪持仓、捕捉机会
  watchlist:
    - code: "600519"                   # 股票代码 (6位数字)
      name: "贵州茅台"                 # 股票名称
    - code: "000858"
      name: "五粮液"
    - code: "000001"
      name: "平安银行"
    - code: "600036"
      name: "招商银行"
    # 添加更多股票:
    # - code: "XXXXXX"
    #   name: "股票名称"

  # -----------------------------------------------------------------------------
  # 信号检测配置 - 自动发现买卖机会
  # -----------------------------------------------------------------------------
  signals:
    # --- 启用的信号检测器 ---
    # 说明: 选择需要启用的技术指标检测器
    # 建议: 根据策略需要选择，不要全部启用
    enabled_detectors:
      - ma_crossover                   # MA均线金叉死叉检测
      - rsi                            # RSI超买超卖检测
      - volume_breakout                # 成交量异常放大检测
      - stop_loss                      # 持仓止损触发检测
      - take_profit                    # 持仓止盈触发检测

    # --- 技术指标参数 ---
    # MA均线参数
    ma_short: 5                        # 短期均线周期 (范围: 5-10)
                                       # 常用: 5日线(周线), 10日线(半月线)

    ma_long: 20                        # 长期均线周期 (范围: 20-60)
                                       # 常用: 20日线(月线), 30日线, 60日线(季线)
                                       # 金叉: 短期上穿长期 → 买入信号
                                       # 死叉: 短期下穿长期 → 卖出信号

    # RSI参数
    rsi_period: 14                     # RSI计算周期 (标准: 14)
    rsi_oversold: 30                   # RSI超卖阈值 (范围: 25-35)
                                       # RSI < 30 视为超卖，可能反弹
    rsi_overbought: 70                 # RSI超买阈值 (范围: 65-75)
                                       # RSI > 70 视为超买，可能回调

    # 成交量参数
    volume_multiplier: 2.0             # 成交量放大倍数 (范围: 1.5-2.5)
                                       # 成交量 > 均量 * 2.0 视为放量

  # -----------------------------------------------------------------------------
  # 提醒设置 - 信号通知和去重
  # -----------------------------------------------------------------------------
  alerts:
    # --- 优先级过滤 ---
    # 只提醒此级别及以上的信号
    # 可选值: low(一般) | medium(重要) | high(紧急) | critical(严重)
    min_priority: "medium"             # 推荐: medium
                                       # low: 所有信号都提醒 (噪音多)
                                       # medium: 只提醒重要以上信号 (平衡)
                                       # high: 只提醒紧急信号 (可能错过机会)

    # --- 通知渠道 ---
    # 说明: 选择信号的输出渠道
    # 可选: console(控制台) | log(日志) | email(邮件) | wechat(微信)
    channels:
      - console                        # 控制台输出 (开发测试用)
      - log                            # 写入日志文件 (生产环境)
      # - email                        # 邮件通知 (需配置SMTP)
      # - wechat                       # 微信通知 (需配置企业微信)

    # --- 去重窗口 (秒) ---
    # 同一股票同一类型信号在此时间窗口内不重复提醒
    dedup_window: 900                  # 15分钟 (范围: 300-1800)
                                       # 短线: 5-10分钟, 中长线: 15-30分钟
                                       # 避免同一信号反复骚扰

    # --- 交易时间限制 ---
    trading_hours_only: false          # 是否仅在交易时间提醒
                                       # true: 只在9:30-15:00提醒
                                       # false: 全天提醒 (包括盘后分析)

    # --- 邮件通知配置 ---
    # 说明: 配置SMTP邮件发送功能
    # 注意: 密码等敏感信息从环境变量读取（.env文件）
    email:
      # SMTP服务器配置
      smtp_server: smtp.gmail.com      # SMTP服务器地址
                                       # Gmail: smtp.gmail.com
                                       # QQ邮箱: smtp.qq.com
                                       # 163邮箱: smtp.163.com
                                       # Outlook: smtp.office365.com

      smtp_port: 587                   # SMTP端口
                                       # TLS/STARTTLS: 587
                                       # SSL: 465
                                       # 非加密: 25 (不推荐)

      use_tls: true                    # 是否使用TLS加密
                                       # true: 使用TLS (端口587)
                                       # false: 使用SSL (端口465) 或不加密

      # 发件人配置 (从环境变量读取)
      sender: ${EMAIL_SENDER}          # 发件人邮箱地址
      sender_password: ${EMAIL_PASSWORD}  # 发件人邮箱密码或应用专用密码

      # 收件人列表
      recipients:
        - user@example.com             # 收件人1
        # - user2@example.com          # 收件人2 (可添加多个)

      # 邮件主题模板
      subject_template: "[A股监控] {signal_type} - {stock_name}"
                                       # 可用变量: {signal_type}, {stock_code}, {stock_name}, {priority}

      # 重试机制
      max_retries: 3                   # 最大重试次数 (范围: 1-5)
      retry_delay: 1                   # 重试间隔秒数 (范围: 1-10)

      # 发送频率限制
      rate_limit_seconds: 300          # 同一股票邮件发送间隔 300秒 = 5分钟
                                       # 防止短时间内重复发送邮件
                                       # 范围: 60-1800 (1分钟-30分钟)

  # -----------------------------------------------------------------------------
  # 持仓监控 - 实时跟踪持仓风险
  # -----------------------------------------------------------------------------
  position_monitoring:
    enabled: true                      # 是否启用持仓监控 (建议: true)
                                       # 功能: 实时更新持仓市值、检测止损止盈、评估风险

    check_interval: 300                # 检查间隔 300秒 = 5分钟 (范围: 60-600)
                                       # 盘中建议: 1-5分钟
                                       # 盘后可降低频率

# -----------------------------------------------------------------------------
# 风险管理配置 - 与risk_rules.yaml相同，用于监控服务
# -----------------------------------------------------------------------------
# 说明: 此部分配置与risk_rules.yaml重复，但监控服务需要单独配置
# 建议: 保持与risk_rules.yaml一致，或根据监控需要微调
risk:
  # --- 总资金 ---
  total_capital: 1000000               # 初始资金100万 (根据实际调整)
                                       # 用于计算仓位比例、风险指标等

  # --- 仓位限制 ---
  position:
    max_single_position: 0.20          # 单一持仓≤20% (与risk_rules.yaml保持一致)
    max_sector_exposure: 0.30          # 单一行业≤30%
    max_total_position: 0.95           # 总仓位≤95%

  # --- 止损配置 ---
  stop_loss:
    method: "fixed"                    # 止损方式: fixed/trailing/atr
    fixed_ratio: 0.08                  # 固定止损8%
    trailing_ratio: 0.05               # 移动止损5%
    atr_multiplier: 2.0                # ATR倍数

  # --- 止盈配置 ---
  take_profit:
    method: "fixed"                    # 止盈方式: fixed/dynamic
    fixed_ratio: 0.15                  # 固定止盈15%

# =============================================================================
# 监控服务使用说明:
#
# 1. 启动监控服务:
#    python -m src.monitoring.monitoring_service
#
# 2. 添加监控股票:
#    在watchlist中添加股票代码和名称
#
# 3. 调整监控频率:
#    - 盘中实时监控: update_interval=30-60秒
#    - 盘后分析: update_interval=300-600秒
#
# 4. 优先级设置:
#    - 只想看重要信号: min_priority="high"
#    - 想看所有信号: min_priority="low"
#
# 5. 通知渠道:
#    - 开发测试: channels=[console]
#    - 生产环境: channels=[log, email]
#
# 6. 性能优化:
#    - 监控股票不超过30只
#    - update_interval不低于30秒
#    - 合理设置cache.ttl降低API调用
#
# 详细说明请参考: docs/CONFIGURATION_GUIDE.md
# =============================================================================
